
@{
    ViewBag.Title = "Checkout";
    var cart = ViewBag.Cart;
    var customer = ViewBag.Customer;
}

<div class="breadcrumb-area pt-30">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb-content">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li class="active">Checkout</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- FB's Breadcrumb Area End Here -->
<!--Checkout Area Strat-->
<div class="checkout-area pt-60 pb-30">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="coupon-accordion">
                    <!--Accordion Start-->
                    <h3>Returning customer? <a href='@Url.Action("Index","Customer")'><span id="showlogin">Click here to login</span></a></h3>
                    @if (Session["cart"] != null )
                    {
                        <div id="checkout-login" class="coupon-content">
                        <div class="coupon-info">
                            <p class="coupon-text">Quisque gravida turpis sit amet nulla posuere lacinia. Cras sed est sit amet ipsum luctus.</p>
                            <form data-customer="@customer.Id" class="form-checkout">
                                    <p class="form-row-first">
                                        <label>Username or email <span class="required">*</span></label>
                                        <input type="text">
                                    </p>
                                    <p class="form-row-last">
                                        <label>Password  <span class="required">*</span></label>
                                        <input type="text">
                                    </p>
                                    <p class="form-row">
                                        <input value="Login" type="submit">
                                        <label>
                                            <input type="checkbox">
                                            Remember me
                                        </label>
                                    </p>
                                    <p class="lost-password"><a href="#">Lost your password?</a></p>
                                </form>
                        </div>
                    </div>
                    }
                    <!--Accordion End-->
                    <!--Accordion Start-->
                    <div id="checkout_coupon" class="coupon-checkout-content">
                        <div class="coupon-info">
                            <form action="#">
                                <p class="checkout-coupon">
                                    <input placeholder="Coupon code" type="text">
                                    <input value="Apply Coupon" type="submit">
                                </p>
                            </form>
                        </div>
                    </div>
                    <!--Accordion End-->
                </div>
            </div>
        </div>
        @if (Session["cart"] != null)
        {
            <div class="row">
            <div class="col-lg-6 col-12">
                <form action="#">
                    <div class="checkbox-form">
                        <h3>Shipping address</h3>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="checkout-form-list mb-30">
                                    <label>Country <span class="required">*</span></label>
                                    <input placeholder="" type="text" id="country">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list">
                                    <label>First Name <span class="required">*</span></label>
                                    <input placeholder="" type="text" id="firstname">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list">
                                    <label>Last Name <span class="required">*</span></label>
                                    <input placeholder="" type="text" id="lastname">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="checkout-form-list mb-30">
                                    <label>Address <span class="required">*</span></label>
                                    <input placeholder="Street address" type="text" id="address">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="checkout-form-list">
                                    <label>Town / City <span class="required">*</span></label>
                                    <input type="text" id="city">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list">
                                    <label>Email Address <span class="required">*</span></label>
                                    <input placeholder="" type="email" id="email">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list">
                                    <label>Phone  <span class="required">*</span></label>
                                    <input type="text" id="Phone">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-lg-6 col-12">
                <div class="your-order">
                    <h3>Your order</h3>
                    <div class="your-order-table table-responsive">
                        <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th class="cart-product-name">Product</th>
                                                        <th class="cart-product-total">Total</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                @{
                                    var total = 0;
                                }
                                @foreach (var item in cart)
                                {
                                        total += item.Product.Price * item.Quantity;
                                    <tr class="cart_item">
                                        <td class="cart-product-name"> @item.Product.Name<strong class="product-quantity"> × @item.Quantity</strong></td>
                                        <td class="cart-product-total"><span class="amount">$@(@item.Product.Price * @item.Quantity)</span></td>
                                    </tr>
                                }
                            </tbody>
                                                <tfoot>
                                                    <tr class="cart-subtotal">
                                                        <th>Cart Subtotal</th>
                                                        <td><span class="amount">$@total</span></td>
                                                    </tr>
                                                    <tr class="order-total">
                                                        <th>Order Total</th>
                                                        <td><strong><span class="amount">$@total</span></strong></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                    </div>
                    <div class="payment-method">
                        <div class="payment-accordion">
                            <div id="accordion">
                                <div class="card">
                                    <div class="card-header" id="#payment-1">
                                        <h5 class="panel-title">
                                            <a class="" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                Direct Bank Transfer.
                                            </a>
                                        </h5>
                                    </div>
                                    <div id="collapseOne" class="collapse show" data-parent="#accordion">
                                        <div class="card-body">
                                            <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order won’t be shipped until the funds have cleared in our account.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card pt-15">
                                    <div class="card-header" id="#payment-2">
                                        <h5 class="panel-title">
                                            <a class="collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                                Cheque Payment
                                            </a>
                                        </h5>
                                    </div>
                                    <div id="collapseTwo" class="collapse" data-parent="#accordion">
                                        <div class="card-body">
                                            <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order won’t be shipped until the funds have cleared in our account.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header" id="#payment-3">
                                        <h5 class="panel-title">
                                            <a class="collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                                PayPal
                                            </a>
                                        </h5>
                                    </div>
                                    <div id="collapseThree" class="collapse" data-parent="#accordion">
                                        <div class="card-body">
                                            <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order won’t be shipped until the funds have cleared in our account.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="order-button-payment">
                                <input value="Place order" class="action-order" type="button">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        }
    </div>
</div>
<!--Checkout Area End-->
<!-- Begin FB's Branding Area -->
<div class="fb-branding-wrap pb-60">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="fb-branding bg-white">
                    <div class="fb-branding_active owl-carousel">
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/1.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/2.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/3.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/4.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/5.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/6.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/1.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                        <div class="branding-item">
                            <a href="#">
                                <img src='@Href("~/images/branding/2.jpg")' alt="FB's Branding">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@if(Session["cart"] != null) { 
<script>

        $(document).ready(function () {
            $('.action-order').click(function () {
                var data = {
                    Id: generateId(6),
                    Status: false,
                    AccCustomerId: "@customer.Id",
                    Country: $("#country").val(),
                    FirstName: $("#firstname").val(),
                    LastName: $("#lastname").val(),
                    Address: $("#address").val(),
                    City: $("#city").val(),
                    Email: $('#email').val(),
                    Phone: $('#phone').val(),
                };
                $.ajax({
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    url: 'http://localhost:50002/Checkout/Order',
                    data: JSON.stringify(data),
                    success: function (response) {
                        loadCart();
                    }
                });
            })
            function generateId(length) {
                var result = '';
                var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                var charactersLength = characters.length;
                for (var i = 0; i < length; i++) {
                    result += characters.charAt(Math.floor(Math.random() * charactersLength));
                }
                return result;
            }
            function loadCart() {
                var content = '';
                var count = 0;
                var total = 0;
                $.get("http://localhost:50002/Cart/GetCart", function (cart) {
                    cart.map(function (item, index) {
                        count += item.Quantity;
                        total += item.Quantity * item.ProductPrice;
                        content += '<li> <a href="http://localhost:50002/Product/Index/' + item.ProductId + '" class="minicart-product-image"> <img src="' + item.ProductImage + '" alt="' + item.ProductName + '"> <span class="product-quantity">' + item.Quantity + 'x</span> </a> <div class="minicart-product-details"> <h6><a href="http://localhost:50002/Product/Index/' + item.ProductId + '">' + item.ProductName + '</a></h6> <span>$' + item.ProductPrice + '</span> </div><button class="close" title="Remove"> <i class="fa fa-close"></i> </button> </li>';
                    })
                    if (cart.length > 0) {
                        $('.minicart-product-list').html(content);
                        $('.cart-item-count').html(count);
                        $('.item-total').html(total);
                    }
                });
            }
        })
    </script>}
